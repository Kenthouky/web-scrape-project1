app.controller('Document_Manager',function($scope,DocumentManagerService){console.log("Document_Manager Controller reporting for duty.");DocumentManagerService.getMyApplications().then(function(response){$scope.APPLICATIONS=response.data;});DocumentManagerService.getMyScholarshipApplications().then(function(response){$scope.SCHOLARSHIP_APPLICATIONS=response.data.data;});$scope.SHOW_FILE_MANAGER=false;$scope.SolidaritySelected=true;$scope.SELECT_APPLICATION=function(index){$scope.ACTIVE_APPLICATION=$scope.APPLICATIONS.filter(function(application){return application.id==index;})[0];$scope.SHOW_FILE_MANAGER=true;$scope.SolidaritySelected=true;window.scrollTo(0,0);};$scope.SELECT_SCHOLARSHIP_APPLICATION=function(index){$scope.ACTIVE_APPLICATION=$scope.SCHOLARSHIP_APPLICATIONS.filter(function(application){return application.id==index;})[0];$scope.SHOW_FILE_MANAGER=true;$scope.SolidaritySelected=false;window.scrollTo(0,0);};$scope.SELECT_ATTACHMENT=function(id,$event){var extensions=$($event.target).data("ext");if(extensions!=null&&extensions!=""){$("input[type=file]").attr("accept",extensions);}
else{$("input[type=file]").removeAttr("accept");}
$("input[type=file]").click();$scope.EDITED_FILE_ID=id;console.log($scope.EDITED_FILE_ID);};$scope.uploadFile=function(){$("#loader_"+$scope.EDITED_FILE_ID).removeClass("d-none");$(".uploadBtn").attr("disabled","disabled");var file=document.getElementById("ATTACHMENT").files[0];if($scope.SolidaritySelected){DocumentManagerService.uploadFileToUrl(file,$scope.ACTIVE_APPLICATION.id,$scope.EDITED_FILE_ID).then(function(res){if(res.data.data==true){DocumentManagerService.getMyApplications().then(function(response){$("#loader_"+$scope.EDITED_FILE_ID).addClass("d-none");$(".uploadBtn").removeAttr("disabled","disabled");$scope.APPLICATIONS=response.data;var oldActiveAppId=$scope.ACTIVE_APPLICATION.id;$scope.ACTIVE_APPLICATION=$scope.APPLICATIONS.filter(function(application){return application.id==oldActiveAppId;})[0];});}
else{$("input[type=file]").val('');$("#uploadErrDetail").html(res.data.message);$('#SHOW_UPLOADING_ERROR').modal('toggle');$("#loader_"+$scope.EDITED_FILE_ID).addClass("d-none");$(".uploadBtn").removeAttr("disabled","disabled");}}).catch(function(res){$("input[type=file]").val('');$("#uploadErrDetail").html("Lütfen en fazla 10 MB büyüklüğünde bir dosya yükleyiniz!");$('#SHOW_UPLOADING_ERROR').modal('toggle');$("#loader_"+$scope.EDITED_FILE_ID).addClass("d-none");$(".uploadBtn").removeAttr("disabled","disabled");});}
else{DocumentManagerService.uploadScholarFileToUrl(file,$scope.ACTIVE_APPLICATION.id,$scope.EDITED_FILE_ID).then(function(res){if(res.data==true){DocumentManagerService.getMyScholarshipApplications().then(function(response){$scope.SCHOLARSHIP_APPLICATIONS=response.data.data;var oldActiveAppId=$scope.ACTIVE_APPLICATION.id;$scope.ACTIVE_APPLICATION=$scope.SCHOLARSHIP_APPLICATIONS.filter(function(application){return application.id==oldActiveAppId;})[0];});}
else{$("input[type=file]").val('');$('#SHOW_UPLOADING_ERROR').modal('toggle');}
$("#loader_"+$scope.EDITED_FILE_ID).addClass("d-none");$(".uploadBtn").removeAttr("disabled","disabled");});}};$scope.CloseDocument=function(){$scope.SHOW_FILE_MANAGER=false;$scope.ACTIVE_APPLICATION=null;};$scope.UPDATE_USER_DOCUMENTS=function(){var dataObj=$.param({RELATED_ID:$scope.ACTIVE_APPLICATION.ID,FILE_DATA:JSON.stringify($scope.ACTIVE_APPLICATION.REQUESTED_DOCUMENTS),});var config={headers:{'Content-Type':'application/x-www-form-urlencoded;charset=utf-8;'}};$http.post(BASE_URL+'api/UPDATE_USER_DOCUMENTS',dataObj,config).then(function(RESPONSE){console.log(RESPONSE);$scope.GET_SCHOLAR_DATA()},function(RESPONSE){console.log(RESPONSE);});}
$scope.getFileUrl=function(id){DocumentManagerService.getFileUrl(id).then(function(res){if(res.data!=null&&res.data!=""){window.open(res.data,'_blank');}});};$scope.getScholarFileUrl=function(id){DocumentManagerService.getScholarFileUrl(id).then(function(res){if(res.data!=null&&res.data!=""){window.open(res.data,'_blank');}});};$scope.getPrintableDocument=function(id){$("#getPrintableDocumentBtn").attr("disabled","disabled").attr("title","Lütfen bekleyiniz...").html("Başvuruyu Yazdır <img src='/assets/img/loading_avatar.gif' width='20'>");DocumentManagerService.getPrintableDocument(id).then(function(res){var dstFrame=document.getElementById('printableArea');var dstDoc=dstFrame.contentDocument||dstFrame.contentWindow.document;dstDoc.write(res.data);dstDoc.close();dstFrame.contentWindow.print();$("#getPrintableDocumentBtn").removeAttr("disabled").attr("title","").html("Başvuruyu Yazdır");},function(res){alert("Bir hata oluştu!");$("#getPrintableDocumentBtn").removeAttr("disabled").attr("title","").html("Başvuruyu Yazdır");});};$scope.ShowDocumentDetail=function(id){var document=$scope.ACTIVE_APPLICATION.docs.find(p=>p.id==id);if(document!=null&&document!=undefined){$("#documentDetailModalHeader").html(document.fileName);$("#documentDetailModalBody").html(document.fileDetailedDesc);$("#SHOW_DOCUMENT_DETAIL").modal("toggle");}}});