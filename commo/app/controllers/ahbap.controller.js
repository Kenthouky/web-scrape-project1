app.controller('Ahbap',function($scope,$http,AhbapService,CommonService){console.log("Ahbap Controller reporting for duty.");$scope.email_pattern=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;$scope.app_url=BASE_URL;$scope.CDN_URL=CDN_URL;$scope.S3_URL=S3_URL;$scope.S3_NEWS_URL=S3_NEWS_URL;$scope.RECURRING_DONATION=false;$scope.DONATION_AMOUNT=null;$scope.SET_DONATION_AMOUNT=function(AMOUNT){$scope.DONATION_AMOUNT=AMOUNT;};$scope.DONATION_AMOUNT_IS=function(AMOUNT){return AMOUNT===$scope.DONATION_AMOUNT;};$scope.GO_PATH=function(PATH){window.location.href=BASE_URL+PATH;};$scope.MAKE_DONATE=function(){fz.bagis({api_key:"coGU2N2kUJuHi3w0WNJyFXuf79m5384AggK6Nhr41Eo=",amount:$scope.DONATION_AMOUNT,campaign:"yMDSTROgRHLTuwXsGXZQ/nL42/szGeC92F/O60oRvVs=",recurring:$scope.RECURRING_DONATION,});};$scope.SUBSCRIBED=null;$scope.SUBSCRIBE=function(){AhbapService.subscribe($scope.SUBSCRIBER_EMAIL).then(function(response){console.log(response);if(response.data){console.log(response);$scope.SUBSCRIBED=true;$scope.SUBSCRIBER_EMAIL="";}
if(!response.data){console.log(response);$scope.SUBSCRIBED=false;}}).catch(function(){$scope.SUBSCRIBED=false;});};$scope.SEARCH=function(){localStorage.setItem("SEARCH_WORD",$scope.SEARCH_WORD);window.location.href=BASE_URL+'arama-yap';};AhbapService.getUserInfo().then(function(USER){$scope.USER_DATA=USER.data.Data;if($scope.USER_DATA){if($scope.USER_DATA.AdditionalData==null||$scope.USER_DATA.AdditionalData==undefined){$scope.USER_DATA.AdditionalData={};}
if($scope.USER_DATA.AdditionalData._Hobbies===null){$scope.USER_DATA.AdditionalData._Hobbies=[];}
if($scope.USER_DATA.AdditionalData.CountryID===null||$scope.USER_DATA.AdditionalData.CountryID===undefined){$scope.USER_DATA.AdditionalData.CountryID=223;}
$scope.initPage();$scope.ACCEPT_USER_AGREEMENT=function(){AhbapService.acceptUserAgreement().then(function(response){if(response.data!==false){$('#USER_AGREEMENT').modal('hide');}});};$scope.DECLINE_USER_AGREEMENT=function(){window.location.href=BASE_URL;};AhbapService.checkUserAgreement().then(function(response){$scope.USER_EMAIL_CONFIRMATED=response.data;if(response.data==='false'){$('#USER_CONFIRMATION').modal('show');}});$scope.SEND_CONFIRMATION_REQUEST=function(){AhbapService.sendConfirmationRequest().then(function(response){if(response.data!==false){$('#USER_CONFIRMATION').modal('hide');$('#USER_CONFIRMATION_SENT').modal('show');}});};$scope.RESET_SCHOLARSHIP_APPLY=function(){AhbapService.resetScholarshipApply().then(function(response){console.log(response);window.location.href=BASE_URL+'burs_basvuru';});};}});$scope.isVolunteer=false;AhbapService.checkVolunteer().then(function(response){$scope.isVolunteer=response;});$scope.PRINT=function(){window.print();};$scope.LOGIN=function(){AhbapService.login($scope.USERNAME,$scope.PASSWORD).then(function(response){console.log(response);if(response.data){console.log(response);window.location.href=BASE_URL+"ahbap";}
if(!response.data){console.log(response);$scope.LOGIN_ALERT=true;}});};$scope.REGISTER=function(){AhbapService.register($scope).then(function(response){console.log(response);if(response.data){console.log(response);window.location.href=BASE_URL+"giris";}
if(!response.data){console.log(response);$scope.REGISTER_ALERT=true;}});};$scope.LOGOUT=function(){AhbapService.logout().then(function(response){console.log(response);if(response.data){console.log(response);window.location.href=BASE_URL;}
if(response.data){console.log(response);}},function(response){console.log(response);});};$scope.ShowContactWarning=false;$scope.SelectedContact=null;$scope.SelectedCity=null;$scope.ChangeContactCategory=function(){var descText=$("#ContactTypeCategoryId").find(":selected").data("description");if(descText==undefined){$scope.ShowContactWarning=false;}
else if(descText.length>0){$("#categoryDescription").html(descText);$scope.ShowContactWarning=true;}
else{$scope.ShowContactWarning=false;}};$scope.CONTACT=function(){jQuery.validator.addMethod("phonenu",function(value,element){return this.optional(element)||/^(\+90-|\+90|0)?\d{10}$/.test(value);},"Geçerli bir telefon numarası giriniz.");$("#deneme").validate({rules:{Name:"required",Subject:"required",Message:"required",ContactTypeCategoryId:"required",Email:{required:true,email:true},Phone:{required:true,phonenu:true},KvkkConfirm:{required:true}},messages:{Name:"Bu alan boş bırakılamaz",Subject:"Bu alan boş bırakılamaz",Message:"Bu alan boş bırakılamaz",Phone:{required:"Bu alan boş bırakılamaz",},Email:{required:"Bu alan boş bırakılamaz",email:"Lütfen geçerli bir email giriniz"},ContactTypeCategoryId:{required:"Bu alan boş bırakılamaz",},KvkkConfirm:{required:"KVKK metnini onaylamadan formu gönderemezsiniz."}},errorPlacement:function(error,element){error.addClass("text-danger");if(element.attr("type")=="checkbox"){error.insertAfter($(element).parents().first());}
else{error.insertAfter($(element));}},submitHandler:function(form){var baseUrl=window.location.origin;console.log('baseUrl',baseUrl)
var fd=new FormData();var dataObj={Name:document.getElementById('Name').value,Email:document.getElementById('Email').value,Phone:document.getElementById('Phone').value,Subject:document.getElementById('Subject').value,Message:document.getElementById('Message').value,ContactTypeCategoryId:document.getElementById('ContactTypeCategoryId').value};fd.append("File",document.getElementById('contactFileInput').files[0]);fd.append("Data",dataObj);var config={headers:{"Content-Type":"multipart/form-data;"}};var postUrl=baseUrl+"/api/Contact/InsertContact";$("#contactFormSubmitBtn").attr("disabled","disabled");$http.post(postUrl,fd,config).then(function(response){$("#contactFormSubmitBtn").removeAttr("disabled");if(response.status===200){var title=response.data.data==false?'Başarısız!':'Başarılı!';var icon=response.data.data==false?'error':'success';Swal.fire({title:title,text:response.data.message,icon:icon,showConfirmButton:false,timer:4000,}).then(()=>{document.getElementById('Name').value='';document.getElementById('Email').value='';document.getElementById('Phone').value='';document.getElementById('Subject').value='';document.getElementById('Message').value='';})}
else{Swal.fire({title:'Hata!',text:'Bişeyler yanlış gitti. Lütfen daha sonra tekrar deneyiniz!!!',icon:'error',timer:4000,}).then((result)=>{window.location.reload();});}});}});};$scope.FEATURE_USABILITY=function(feature){AhbapService.getFeatureUsability(feature).then(function(response){return response.data;});};AhbapService.getMenus().then(function(response){$scope.MENUS=response.data.data;});AhbapService.getDonationCategories().then(function(response){$scope.DONATION_CATEGORIES=response.data.data;});AhbapService.getDonationFeedbackItems().then(function(response){$scope.DONATION_FEEDBACK_ITEMS=response.data.data;});AhbapService.getDonationContractItems().then(function(response){$scope.DONATION_CONTRACT_ITEMS=response.data.data;});$scope.initPage=async function(){};$scope.SMCC={CONTENT:"",SHARING_DATE:"",PLATFORM:"",ADDITIONAL_NOTES:"",EXTERNAL_FILE_URLS:"",NODE_ID:"",};$scope.SOCIAL_MEDIA_PLATFORMS=[{ID:1,NAME:'Twitter',ICON:'ti-twitter'},{ID:2,NAME:'Facebook',ICON:'ti-facebook'},{ID:3,NAME:'Instagram',ICON:'ti-instagram'}];$scope.SEND_SOCIAL_MEDIA_CONTENT_FOR_CONFIRMATION=function(){AhbapService.socialMediaConfirmation($scope).then(function(response){console.log(response);if(response.data){console.log(response);}
if(response.data){console.log(response);}},function(response){console.log(response);});};$scope.SELECT_ATTACHMENT=function(){$("input[type=file]").click();};$scope.TMP_UPLOADS=[];$scope.UPLOAD_ATTACHMENT=function(){var fd=new FormData();var files=document.getElementById("ATTACHMENT").files[0];fd.append("file",files);AhbapService.uploadAttachment($scope).then(function successCallback(UPLOADED_ATTACHMENT){$scope.UPLOADED_ATTACHMENT=UPLOADED_ATTACHMENT.data;$scope.TMP_UPLOADS.push($scope.UPLOADED_ATTACHMENT);});};$scope.REMOVE_FILE=function(file,path){AhbapService.removeFile(file,path).then(function(response){console.log(response);if($scope.TICKET){$scope.GET_TICKET_DETAIL();}
if($scope.TMP_UPLOADS){$scope.TMP_UPLOADS.splice($scope.TMP_UPLOADS.indexOf(file),1);}},function(RESPONSE){console.log(RESPONSE);});};$scope.DOWNLOAD_FILE=function(file){$scope.FILE=file;AhbapService.downloadFile(file).then(function(RESPONSE){console.log(RESPONSE);},function(RESPONSE){console.log(RESPONSE);});};}).directive('chooseFile',function(){return{link:function(scope,elem,attrs){var uploadbutton=elem.find('#uploadButton');var removebutton=elem.find('#uploadRemoveButton');var input=angular.element(elem[0].querySelector('input#contactFileInput'));uploadbutton.bind('click',function(){input[0].click();});input.bind('change',function(e){scope.$apply(function(){var files=e.target.files;if(files[0]){$("#contactFileName").val(files[0].name);removebutton.removeClass("d-none");}else{$("#contactFileName").val("");}});});removebutton.bind('click',function(){input[0].value="";$("#contactFileName").val("");removebutton.addClass("d-none");});}};});